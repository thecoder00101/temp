<?php include _include(APP_PATH.'view/htm/header.inc.htm');?>

<div class="row">
	<div class="col-lg-12">
		<div class="card mb-0 mb-lg-3">
			<div class="card-body">
				<div class="row">
					<div class="col-lg-6">
						<?php
$slidelist = db_find('swiperpic', array(), array('slideid'=>1), 1, 1000, 'slideid');
?>

	<div class="swiper mySwiper">
		<div class="swiper-wrapper">
				<?php if($slidelist) { foreach ($slidelist as $key => $link) { ?>
			<div class="swiper-slide">
				<a href="<?php echo $link['url'];?>" title="<?php echo $link['name'];?>">
					<img class="d-block w-100  rounded" src="<?php echo $link['slidepic'];?>" alt="<?php echo $link['name'];?>">
					<div class="carousel-caption">
						<h5 class="text-white" style="text-shadow:0px 0px 10px black;"><?php echo $link['name'];?></h5>
					</div>
				</a>
			</div>
			<?php }
		} ?>
		</div>
		<div class="swiper-button-next"></div>
		<div class="swiper-button-prev"></div>
		<div class="swiper-pagination"></div>
	</div>
					</div>
					<div class="col-lg-6 discovery-main-right mt-3 mt-lg-0">
						<nav>
							<div class="nav nav-tabs nav-justified" id="nav-tab" role="tablist">
							<a class="nav-link active" id="digest-1-tab" data-toggle="tab" href="#digest_1" role="tab" aria-controls="nav-digest-1" aria-selected="true"><?php echo lang('d_new');?></a>
<a class="nav-link" id="digest-2-tab" data-toggle="tab" href="#digest_2" role="tab" aria-controls="nav-digest-2" aria-selected="false"><?php echo lang('d_newreply');?></a>
<a class="nav-link" id="nav-comment-tab" data-toggle="tab" href="#nav-comment" role="tab" aria-controls="nav-comment" aria-selected="false"><?php echo lang('discovery_newcomments');?></a>
<a class="nav-link" id="all-rank-tab" data-toggle="tab" href="#nav-allrank" role="tab" aria-controls="nav-allrank" aria-selected="false"><?php echo lang('discovery_totalrank');?></a>

							</div>
						</nav>
						<div class="tab-content" id="nav-tabContent">
							<div class="tab-pane fade show active" id="digest_1" role="tabpanel" aria-labelledby="digest-1-tab">
	<div class="site-top">
		<ul class="site-list-ul discovery-rank-list">
			<?php 
			$new_list = get_new_threadlist(); //获取最新的帖子
    	thread_list_access_filter($new_list, $gid);//过滤没有权限访问的帖子，必须要做
			if($new_list) {
				foreach($new_list as $thread) {
					$avatar_url = 'upload/avatar/000/'.$thread['uid'].'.png';
				if(file_exists($avatar_url)==false){
					$avatar_url = 'view/img/avatar.png';
				}
					?>
			<li class="d-flex justify-content-between">
				<div class="text-truncate">
					<a href="<?php echo url("user-$thread[uid]");?>"><img src="<?php echo $avatar_url;?>" alt="用户头像" class="avatar-1 mr-1"></a>
					<a href="<?php echo url("thread-$thread[tid]");?>"><?php echo $thread['subject'];?></a>
				</div>
				<div class="text-nowrap">
					<span class="date text-grey"><?php echo humandate($thread['create_date'])?></span>
				</div>
			</li>
			<?php }} else { ?>
				<?php echo lang('none');?>
			<?php } ?>
	</ul>	
	</div>
</div>

<div class="tab-pane fade" id="digest_2" role="tabpanel" aria-labelledby="digest-2-tab">
	<div class="site-top">
		<ul class="site-list-ul discovery-rank-list">
			<?php 
			$newReplylist = get_new_reply_threadlist(); //获取精华二的帖子
    	thread_list_access_filter($newReplylist, $gid);//过滤没有权限访问的帖子，必须要做
			if($newReplylist) {
				foreach($newReplylist as $thread) {
					$avatar_url = 'upload/avatar/000/'.$thread['uid'].'.png';
				if(file_exists($avatar_url)==false){
					$avatar_url = 'view/img/avatar.png';
				}
					?>
			<li class="d-flex justify-content-between">
				<div class="text-truncate">
					<a href="<?php echo url("user-$thread[uid]");?>"><img src="<?php echo $avatar_url;?>" alt="用户头像" class="avatar-1 mr-1"></a>
					<a href="<?php echo url("thread-$thread[tid]");?>"><?php echo $thread['subject'];?></a>
				</div>
				<div class="text-nowrap">
					<span class="date text-grey"><?php echo humandate($thread['create_date'])?></span>
				</div>
			</li>
			<?php }} else { ?>
				<?php echo lang('none');?>
			<?php } ?>
	</ul>	
	</div>
</div>


<div class="tab-pane fade" id="nav-allrank" role="tabpanel" aria-labelledby="all-rank-tab">
	<div class="site-top">
	<ul class="site-list-ul discovery-rank-list">
		<?php
			$toplist = discovery_get_site_top_list();
			if($toplist){
			thread_list_access_filter($toplist, $gid);
			foreach ($toplist as $k => $value){
				$_class = $k < 3 ? 'badge-danger' : 'badge-secondary';
				echo '<li class="d-flex justify-content-between"><div class="text-truncate"><span class=" badge mr-2 badge-pill '.$_class.'">'.($k+1).'</span><a href="thread-'.$value['tid'].'.htm">'.$value['subject'].'</a></div>
				<div class="text-nowrap">
					<span class="date text-grey">'.humandate($value['create_date']).'</span>
				</div>
				</li>';
			}}
		?>
	</ul>
</div>
</div>

<div class="tab-pane fade" id="nav-comment" role="tabpanel" aria-labelledby="nav-comment-tab">
	<div class="site-top">
		<ul class="site-list-ul discovery-rank-list">
			<?php
			$ax_posts = discovery_get_comment_list();
			 if($ax_posts) {
				foreach($ax_posts as &$post){ ?>
			<li class="d-flex justify-content-between">
				<div class="text-truncate">
					<span><a href="<?php echo url("user-$post[uid]")?>" tabindex="-1" class="mr-2">
							<img class="avatar-1" src="<?php echo $post['user_avatar_url'];?>">
							<span class="username font-weight-bold mx-1"><?php echo $post['username']?></span>
						</a>
					</span>
						<a href="<?php echo url("thread-$post[tid]")?>"><?php echo strip_tags(xn_substr($post['message_fmt'], 0, 25));?></a>
					</div>
					<div class="text-nowrap">
						<span class="date text-grey"><?php echo $post['create_date_fmt']?></span>
					</div>
					</li>
			<?php }} else { ?>
				<?php echo lang('none');?>
			<?php } ?>
	</ul>	
	</div>
</div>

						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="col-lg-9 pr-lg-0">
		<div class="card">
  <div class="card-header">
    <div class="d-flex justify-content-between">
      <div>
        <i class="fas fa-user-friends mr-2"></i><?php echo lang('discovery_partner');?>
      </div>
      <div>
        <?php echo lang('online');?>：<span class="badge badge-success badge-pill"><b><?php echo $runtime['onlines'];?></b>  </span> 
      </div>
    </div>
  </div>
  <div class="card-body">
      <div class="overflow-auto discovery-user">
      <div style="width:800px">
        <?php 
		$userlist = discovery_get_site_new_user(21);
        foreach ($userlist as $user) {
			$user_avatarimg = 'view/img/avatar.png';
			$user['avatar']!=0 && $user_avatarimg = $conf['upload_url'].'avatar/000/'.$user['uid'].'.png?'.$user['avatar'];
      $user['login_name_date'] = $user['dname'].'('.humandate($user['login_date']).')';
			  ?>
			<a title="<?php echo $user['login_name_date'];?>" class="tt" href="<?php echo url("user-$user[uid]");?>">
				<img src="<?php echo $user_avatarimg; ?>" class="avatar-3" alt="<?php echo $user['dname'];?>">
			</a>
		<?php } ?>
      </div>
    </div>
  </div>
</div>


		<div class="card mb-0 mb-lg-3">
			<div class="card-header">
				<i class="fas fa-list mr-2"></i>
				<?php echo lang('discovery_allforum');?>
			</div>
			<div class="card-body py-2">
				<div class="row row-cols-1 row-cols-md-1 row-cols-lg-2">
				<?php foreach($forumlist_show as $_forum) { ?>
					
					<div class="col px-2 py-2">
						<div class="card p-3 rounded discovery_forum overflow-hidden">
						<div class="  media " fid="<?php echo $_forum['fid'];?>" data-active="fid-<?php echo $_forum['fid'];?>">
						<img class="avatar-4 rounded mr-2" src="<?php echo $_forum['icon_url'];?>">
						<div class="media-body">
							<h5><a href="<?php echo url("forum-$_forum[fid]");?>"><?php echo $_forum['name'];?></a><span class="badge badge-primary ml-2"><?php if($_forum['todayposts']>0) echo $_forum['todayposts'];?></span></h5>
							<div class="small mb-2">
							<span class="text-muted"><?php echo lang('mb_threads');?>：<?php echo $_forum['threads'];?></span>
								<span class="text-muted ml-2"><?php echo lang('today_threads');?>：<?php echo $_forum['todaythreads'];?></span>
							</div>
								<p class="text-grey mb-0 small discovery-forum-brief"><?php echo $_forum['brief'];?></p>
						</div>
					</div>
					<hr>
					<div class="d-flex justify-content-between small">
						<div>
							<div class="text-small">
								<span class=" text-muted"><?php echo lang('forum_moderator');?>：</span>
								<?php if($_forum['modlist']) { ?>
								<?php foreach ($_forum['modlist'] as $mod) { ?>
								<a href="<?php echo url("user-$mod[uid]");?>"><img src="<?php echo $mod['avatar_url'];?>"
										class="avatar-1" data-toggle="tooltip" data-placement="top"
										title="<?php echo $mod['username'];?>"></a>
								<?php } ?>
								<?php  } else {?>
								<span class="text-gray"><?php echo lang('no_moderator');?><i class="fa fa-frown"></i></span>
								<?php } ?>
							</div>
						</div>
						<div>
							<span class="into_forum">
								<a class="text-grey rounded into_forum_link" href="<?php echo url("forum-$_forum[fid]");?>"><?php echo lang('discovery_intoforum');?></a>
							</span>
						</div>
					</div>
				</div>
				</div>
					
					<?php } ?>
				</div>
			</div>
		</div>
		
	</div>

	<div class="col-lg-3">
		

<div class="card">
  <div class="card-header">
    <i class="fas fa-fire-alt mr-2"></i><?php echo lang('discovery_hotforum');?>
  </div>
  <div class="card-body">
    <?php
    $hotforumList =  discovery_get_hot_forum();
      if($hotforumList){
        foreach ($hotforumList as $hotforum) { 
          $hotforum['icon_url'] = $hotforum['icon'] ? $conf['upload_url']."forum/$hotforum[fid].png" : 'view/img/forum.png';
          ?>
          <div class="media mb-2">
            <img class=" avatar-3-5  mr-2" src="<?php echo $hotforum['icon_url'];?>">
            <div class="media-body">
              <a href="<?php echo url("forum-$hotforum[fid]");?>">
                <div><?php echo $hotforum['name'];?><span class="badge badge-primary badge-pill ml-2"><?php echo $hotforum['threads'];?></span></div>
              <div class="text-gray hot-forum-breif small mt-2"><?php echo $hotforum['brief'];?></div>
            </a>
            </div>
          </div>
       <?php }}?>
  </div>
</div>

 <div class="card">
  <div class="card-header">
<ul class="nav nav-pills nav-justified" id="pills-tab" role="tablist">
  <li class="nav-item" role="presentation">
    <a class="nav-link active" id="pills-home-tab" data-toggle="pill" href="#pills-home" role="tab" aria-controls="pills-home" aria-selected="true">活跃榜</a>
  </li>
  <li class="nav-item" role="presentation">
    <a class="nav-link" id="pills-profile-tab" data-toggle="pill" href="#pills-profile" role="tab" aria-controls="pills-profile" aria-selected="false">贡献榜</a>
  </li>
  <li class="nav-item" role="presentation">
    <a class="nav-link" id="pills-contact-tab" data-toggle="pill" href="#pills-contact" role="tab" aria-controls="pills-contact" aria-selected="false">财富榜</a>
  </li>
</ul>
</div>
<div class="card-body py-0">
<div class="tab-content" id="pills-tabContent">
  <div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
    <ul class="list-unstyled mb-0">
      <?php
        $loginRankList = discovery_get_login_List();
        if($loginRankList){
          $rank_num = 1;
          foreach ($loginRankList as $loginRankList) { 
            $loginRankList['avatar_url'] = $loginRankList['avatar'] ? 'upload/avatar/000/'.$loginRankList['uid'].'.png' : 'view/img/avatar.png';
           ?>
           <li class="my-2">
            <div class="media">
              <a href="<?php echo url("user-$loginRankList[uid]");?>"><img class="avatar-3 mt-1 mr-2" src="<?php echo $loginRankList['avatar_url'];?>" alt=""></a>
              <div class="media-body">
                <span class="rank_name">
                  <a href="<?php echo url("user-$loginRankList[uid]");?>"><span class="badge badge-pill badge-primary mr-1"></span><?php echo $loginRankList['username'];?></a>
                </span>
                <span class="rank_time d-block text-gray small mt-1">
                  <i class="fas fa-fingerprint"></i> 登录：<?php echo $loginRankList['logins'] ;?>
                </span>
              </div>
              <?php
              switch($rank_num){
                case 1:$badge_color = 'badge-danger';break;
                case 2:$badge_color = 'badge-warning';break;
                case 3:$badge_color = 'badge-primary';break;
                case 4:$badge_color = 'badge-success';break;
                case 5:$badge_color = 'badge-info';break;
              }
              ?>
              <span class="badge mt-2 badge-pill <?php echo $badge_color;?>"><i class="fas fa-medal mr-2"></i><?php echo $rank_num++;?></span>
            </div>
            
          </li>
         <?php }}?>
        </ul>
  </div>
  <div class="tab-pane fade" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab">
    <ul class="list-unstyled mb-0">
      <?php
        $threadRankList = discovery_get_thread_List();
        if($threadRankList){
          $rank_num = 1;
          foreach ($threadRankList as $threadRankList) { 
            $threadRankList['avatar_url'] = $threadRankList['avatar'] ? 'upload/avatar/000/'.$threadRankList['uid'].'.png' : 'view/img/avatar.png';
           ?>
           <li class="my-2">
            <div class="media">
              <a href="<?php echo url("user-$threadRankList[uid]");?>"><img class="avatar-3 mt-1 mr-2" src="<?php echo $threadRankList['avatar_url'];?>" alt=""></a>
              <div class="media-body">
                <span class="rank_name">
                  <a href="<?php echo url("user-$threadRankList[uid]");?>"><span class="badge badge-pill badge-primary mr-1"></span><?php echo $threadRankList['username'];?></a>
                </span>
                <span class="rank_time d-block text-gray small mt-1">
                  <i class="fas fa-hand-holding-heart"></i> 主题：<?php echo $threadRankList['threads'] ;?>
                </span>
              </div>
              <?php
              switch($rank_num){
                case 1:$badge_color = 'badge-danger';break;
                case 2:$badge_color = 'badge-warning';break;
                case 3:$badge_color = 'badge-primary';break;
                case 4:$badge_color = 'badge-success';break;
                case 5:$badge_color = 'badge-info';break;
              }
              ?>
              <span class="badge mt-2 badge-pill <?php echo $badge_color;?>"><i class="fas fa-medal mr-2"></i><?php echo $rank_num++;?></span>
            </div>
            
          </li>
         <?php }}?>
        </ul>
  </div>
  <div class="tab-pane fade" id="pills-contact" role="tabpanel" aria-labelledby="pills-contact-tab">
    <ul class="list-unstyled mb-0">
      <?php
        $goldRankList = discovery_get_gold_List();
        if($goldRankList){
          $rank_num = 1;
          foreach ($goldRankList as $RankList) { 
            $RankList['avatar_url'] = $RankList['avatar'] ? 'upload/avatar/000/'.$RankList['uid'].'.png' : 'view/img/avatar.png';
           ?>
           <li class="my-2">
            <div class="media">
              <a href="<?php echo url("user-$RankList[uid]");?>"><img class="avatar-3 mt-1 mr-2" src="<?php echo $RankList['avatar_url'];?>" alt=""></a>
              <div class="media-body">
                <span class="rank_name">
                  <a href="<?php echo url("user-$RankList[uid]");?>"><span class="badge badge-pill badge-primary mr-1"></span><?php echo $RankList['username'];?></a>
                </span>
                <span class="rank_time d-block text-gray small mt-1">
                  <i class="fa fa-coins"></i> 金币：<?php echo $RankList['golds'] ;?>
                </span>
              </div>
              <?php
              switch($rank_num){
                case 1:$badge_color = 'badge-danger';break;
                case 2:$badge_color = 'badge-warning';break;
                case 3:$badge_color = 'badge-primary';break;
                case 4:$badge_color = 'badge-success';break;
                case 5:$badge_color = 'badge-info';break;
              }
              ?>
              <span class="badge mt-2 badge-pill <?php echo $badge_color;?>"><i class="fas fa-medal mr-2"></i><?php echo $rank_num++;?></span>
            </div>
            
          </li>
         <?php }}?>
        </ul>
  </div>
</div>
</div>
</div>
		</div>
</div>




<?php include _include(APP_PATH.'view/htm/footer.inc.htm');?>

<script>
$('li[data-active="<?php echo empty($light_config['disc_page_index'] && $light_config['disc_page']) ? 'discovery' : 'index'; ?>"]').addClass('active');
$('a[data-active="<?php echo empty($light_config['disc_page_index'] && $light_config['disc_page']) ? 'discovery' : 'index'; ?>"]').addClass('active');
</script>

<script src="https://cdn.staticfile.org/Swiper/8.4.6/swiper-bundle.min.js"></script>
<script>
	var swiper = new Swiper(".mySwiper", {
		slidesPerView: 1,
		spaceBetween: 30,
		autoplay:true,
		loop: true,
		effect: "fade",
		pagination: {
			el: ".swiper-pagination",
			clickable: true,
		},
		navigation: {
			nextEl: ".swiper-button-next",
			prevEl: ".swiper-button-prev",
		},
	});
</script>

