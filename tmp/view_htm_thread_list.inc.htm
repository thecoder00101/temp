<?php if (isset($light_config['thread_list_style']) && $light_config['thread_list_style'] == 1) { ?>
<?php 
$huux_hlight = setting_get('huux_hlight');
if($huux_hlight){
	echo '<div class="d-none huux_hlight">';
		echo '<style type="text/css">';
		for( $i=1; $i<6; $i++ ){
		echo '.huux_thread_hlight_style'.$i.'{color: '.$huux_hlight['hlight_s'.$i.'c'].';font-weight:'.$huux_hlight['hlight_s'.$i.'w'].'}';
		}
		echo '</style>';
	echo '</div>';
}
?>

					<?php 
					if($threadlist) { 
						$have_allowtop = 0;
						foreach($threadlist as &$_thread) {
							$_thread['allowtop'] = forum_access_mod($_thread['fid'], $gid, 'allowtop');
							if($_thread['allowtop']) $have_allowtop = 1;
						}
					}
					?>

					<?php if($threadlist) { foreach($threadlist as &$_thread) { 
						$post = post_read($_thread['firstpid']);
			$content =($post['message']);
			$message = strip_tags($content);
			$message_num = mb_strlen($message);
			$message_omit = '';
			if($message_num > $light_config['thread_summary_word']){
				$message_omit = '...<span class="text-primary text-nowrap">查看更多>></span>';
			}
			$sub_content = mb_substr($message,0,$light_config['thread_summary_word'],'utf-8').$message_omit;
			$pattern="/<[img|IMG].*?src=[\'|\"](.*?(?:[\.gif|\.jpg|\.png]))[\'|\"].*?[\/]?>/";
			$imgcount=preg_match_all($pattern,$content,$match);
			$imgs=array();
			for($i=0;$i<$light_config['thread_summary_pic'];$i++){  
			    if(!empty($match[0][$i])){
			        $imgs[$i]=$match[1][$i];
			    }
			}?>
					<li class="media thread tap <?php echo $_thread['top_class'];?>"
						data-href="<?php echo url("thread-$_thread[tid]");?>" data-tid="<?php echo $_thread['tid'];?>">

						<a <?php if(isset($light_config['user_info_card']) && $light_config['user_info_card']){ ?> data-toggle="popover"  data-trigger="hover" data-html="true" data-content="
						<div class='media'>
							<img class='avatar-4 mr-3' src='<?php echo $_thread['user_avatar_url'];?>'>
							<div class='media-body'>
							  <h5><?php echo $_thread['username'];?></h5>
							  <span class='badge badge-primary mr-2'>UID:<?php echo $_thread['user']['uid'];?></span><span class='badge badge-info mr-2'><?php echo $_thread['user']['groupname'];?></span><span class='badge badge-secondary'><?php echo humandate($_thread['user']['login_date']);?></span>
							  <div class='mt-1'><span class='mr-4'><?php echo lang('threads');?>：<?php echo $_thread['user']['threads'];?></span><span><?php echo lang('posts');?>：<?php echo $_thread['user']['posts'];?></span></div>
							</div>
						  </div>
						" <?php } ?> href="<?php echo url("user-$_thread[uid]");?>" tabindex="-1" class="mt-1 mr-3 online">
							<img class="avatar-3" src="<?php echo $_thread['user_avatar_url'];?>">
						</a>
						<?php if (isset($light_config['user_online']) && $light_config['user_online'] == 1) { ?>
<?php
			foreach($arronline as $online_user) {
			if($online_user['uid'] == $_thread['uid']){
			echo "<i class='icon icon-circle position-absolute  userOnline'  data-toggle='tooltip' data-placement='right' title='在线'></i>";
			} 
		} ; ?>
		<?php }?>
						<div class="media-body">
							<div class="d-flex justify-content-between">
								<div>
							<?php
	    $threadss = setting_get('threadss');
	    $postss = setting_get('postss');
	    	    $today0 = strtotime("-1 month");
	$new_threads = db_count('thread',array('uid'=>$_thread['user']['uid'],'create_date'=>array('>'=>$today0)));
	$new_posts = db_count('post',array('uid'=>$_thread['user']['uid'],'isfirst'=>0,'create_date'=>array('>'=>$today0)));
	
	   if($new_threads >= $threadss & $new_posts >= $postss){ $raw__user_username = $_thread['username'];



$_thread['username']='<span style="color:red;">'.$_thread['username'].'</span>';}?>
							<a href="<?php echo url("user-$_thread[uid]");?>" class="username mr-1"
								uid="<?php echo $_thread['uid'];?>"><?php echo $_thread['username'];?>
								
<?php if (isset($light_config['groupicon_display']) && $light_config['groupicon_display'] == 1) {
  $groupImg = './plugin/zaesky_theme_light/view/img/groupicon/'.$_thread['user']['gid'].'.png';
  if(file_exists($groupImg))  echo '<img src="./plugin/zaesky_theme_light/view/img/groupicon/'.$_thread['user']['gid'].'.png" class="user-group-icon" data-toggle="tooltip" data-placement="top" title="'.$_thread['user']['groupname'].'">';
  }?>

							</a>
							
						</div>
						<div>
							<?php if($_thread['digest'] > 0) { ?>
	<?php if($_thread['digest'] == 1) { ?>
		<span class="badge jb-blue icon-digest-1" aria-hidden="true" data-toggle="tooltip" data-placement="top" title="<?php echo lang('digest_1');?>">精</span>
	<?php } elseif($_thread['digest'] == 2) { ?>
		<span class="badge jb-purple icon-digest-2" aria-hidden="true" data-toggle="tooltip" data-placement="top" title="<?php echo lang('digest_2');?>">精</span>
	<?php } elseif($_thread['digest'] == 3) { ?>
		<span class="badge jb-red icon-digest-3" aria-hidden="true" data-toggle="tooltip" data-placement="top" title="<?php echo lang('digest_3');?>">精</span>
	<?php } ?>
<?php } ?>
							<?php if($_thread['top'] == 3) { ?>
								<span class="badge jb-pink"><?= lang('thread_top') ?></span>
							<?php }else if($_thread['top'] == 1){ ?>
								<span class="badge jb-yellow"><?= lang('thread_top') ?></span>
								<?php } ?>
								
								<?php if($have_allowtop) { ?>
									<?php if($_thread['allowtop']) { ?>
									<input type="checkbox" name="modtid" class="thread_checkbox" value="<?php echo $_thread['tid']; ?>" />
									<?php } ?>
	
									<?php } ?>
						</div>
						</div>
						<div class="small">
							
								<span class="date text-grey"><?php echo $_thread['create_date_fmt'];?></span>
							
							<?php if (isset($light_config['thread_forum_name']) && $light_config['thread_forum_name'] == 1) { ?>
								<?php if ($route == 'index') { ?>
									<a href="<?php echo url("forum-$_thread[fid]");?>" title="<?php echo $_thread['forumname'];?>" class="text-black-50 ml-1"><i class="iconfont icon-huati mr-1"></i><span><?php echo $_thread['forumname'];?></span></a>
								<?php } ?>
								<?php }?>
						</div>
						<div class="style1_subject_body">
							<div class="subject font-weight-bold break-all my-2" style="font-size: <?php echo $light_config['thread_subject_size'];?>px;">
								
								
								<!-- <?php if($_thread['top'] > 0) { ?>
									<i class="icon-top-<?php echo $_thread['top']; ?> rounded"></i>
								<?php } ?> -->
								<?php if($_thread['content_buy'] > 0)
{ ?><!--<img src="./plugin/tt_credits/pay.png" class="user-group-icon" data-toggle="tooltip" data-placement="top" title="" data-original-title="赞助">-->
<i class="icon-shopping-cart" style="color:gold;" aria-hidden="true" title="赞助"></i>
 <?php } ?>
								
								<?php if (isset($route) && ($route == 'my' && $action == 'favorite')) { ?>
	<a href="<?php echo url("forum-$_thread[fid]");?>" target="_blank" title="<?php echo $_thread['forumname'];?>" class="text-grey">[<?php echo $_thread['forumname'];?>]</a>
<?php } ?><?php 
if($_thread['hlight'] > 0) { 
    $huux_hlight = setting_get('huux_hlight');
	switch($_thread['hlight']){
		case 1 : $_thread['subject'] = '<span class="huux_thread_hlight_style1">'.($huux_hlight['hlight_n_io'] ? '['.$huux_hlight['hlight_s1n'].'] ':'').$_thread['subject'].'</span>';break;
		case 2 : $_thread['subject'] = '<span class="huux_thread_hlight_style2">'.($huux_hlight['hlight_n_io'] ? '['.$huux_hlight['hlight_s2n'].'] ':'').$_thread['subject'].'</span>';break;
		case 3 : $_thread['subject'] = '<span class="huux_thread_hlight_style3">'.($huux_hlight['hlight_n_io'] ? '['.$huux_hlight['hlight_s3n'].'] ':'').$_thread['subject'].'</span>';break;
		case 4 : $_thread['subject'] = '<span class="huux_thread_hlight_style4">'.($huux_hlight['hlight_n_io'] ? '['.$huux_hlight['hlight_s4n'].'] ':'').$_thread['subject'].'</span>';break;
		case 5 : $_thread['subject'] = '<span class="huux_thread_hlight_style5">'.($huux_hlight['hlight_n_io'] ? '['.$huux_hlight['hlight_s5n'].'] ':'').$_thread['subject'].'</span>';break;
		default : $_thread['subject'] = $_thread['subject'];
	}
} ?>

								<a href="<?php echo url("thread-$_thread[tid]");?>"><?php echo $_thread['subject'];?></a>
								
<?php if($_thread['digest'] > 0) { ?>
	<?php if($_thread['digest'] == 1) { ?>
		<i class="iconfont icon-jiangzhang icon-digest-1" aria-hidden="true" data-toggle="tooltip" data-placement="top" title="<?php echo lang('digest_1');?>"></i>
	<?php } elseif($_thread['digest'] == 2) { ?>
		<i class="iconfont icon-jiangzhang icon-digest-2" aria-hidden="true" data-toggle="tooltip" data-placement="top" title="<?php echo lang('digest_2');?>"></i>
	<?php } elseif($_thread['digest'] == 3) { ?>
		<i class="iconfont icon-jiangzhang icon-digest-3" aria-hidden="true" data-toggle="tooltip" data-placement="top" title="<?php echo lang('digest_3');?>"></i>
	<?php } ?>
<?php } ?>
							<?php if(!empty($_thread['taglist'])) { foreach($_thread['taglist'] as $tag) { ?>
							<a href="<?php echo url("forum-$_thread[fid]-$page", array('tagids'=>$tag['tagid']));?>" class="badge badge-pill badge-<?php echo empty($tag['style']) ? 'secondary' : $tag['style'];?>"><?php echo $tag['name'];?></a>
							<?php  }} ?>
							<?php if (isset($light_config['new_thread']) && $light_config['new_thread'] == 1) { ?>  
<?php  
	if (date('Y-m-d', $_thread['create_date']) == date('Y-m-d')) {
	?>
	<span class="badge jb-pink badge-pill"><?= lang('new_post_icon') ?></span>
	<?php  }  ?>
    <?php  }  ?>
								
							
								
								<!-- <?php if($_thread['files'] > 0) { ?><i class="icon small filetype other"></i><?php } ?> -->
								

								
								<?php if($_thread['closed'] > 0) { ?><i class="icon-lock"></i><?php } ?>
								

							</div>
							
							<?php if($_thread['content_buy'] > 0 && $user['uid'] != 1){ ?>
								<div class="alert alert-warning" role="alert">
									<i class="fa fa-coins" aria-hidden="true"></i> <?php echo lang('pay_read');?>
								  </div>
								<?php } else  if(strpos($post['message'],'[reply]',0)||strpos($post['message'],'[ttreply]',0)||strpos($post['message'],'[ttlogin]',0) && $user['uid'] != 1){?>
									<div class="alert alert-primary" role="alert">
										<i class="fa fa-low-vision" aria-hidden="true"></i> <?php echo lang('no_read');?>
									  </div>
								<?php } else if($_thread['VIPonly'] > 0 && $user['uid'] != 1){ ?>
									<div class="alert alert-info" role="alert">
										<i class="icon-trophy" aria-hidden="true"></i> <?php echo lang('vip_read');?>
									  </div>
									<?php } else if($_thread['OK']=='0' && $user['uid'] != 1) {?> 
										<div class="alert alert-secondary" role="alert">
											<i class="fas fa-coffee" aria-hidden="true"></i> <?php echo lang('thread_admin_optioning');?>
											</div>
									<?php } else { ?>
									
									<?php if($light_config['thread_summary_word']){ ?>
									<div class="brief small">
											<a href="<?php echo url("thread-$_thread[tid]");?>" class="text-gray"><?php echo $sub_content ? $sub_content : '';?></a>
										</div>
										<?php }?>
										<?php if (isset($light_config['thread_summary']) && $light_config['thread_summary'] == 1) { ?>
										
											
													<?php if ($imgcount > 0) {
														echo '<div class="row px-3 my-2 left_img_box">';
														foreach($imgs as $pic){
												 	echo '<div class="subject_img_box col-4 p-1" ><a href="'.url("thread-$_thread[tid]").'"><img src="'. $pic .'" class="d-block w-100 subject_body_img rounded" style="height: 100px;" alt="点击查看详情" onerror="this.src=\'plugin/zaesky_theme_light/view/img/errpic.png\'" /></a></div>';
													}
													echo '</div>';
												 } } ?>
										
										
									<?php } ?>
							<div class="d-flex justify-content-between small mt-1">
								<div class="text-muted text-nowrap">
									
									<span data-toggle="tooltip" data-placement="top" title="浏览"><span class="iconfont icon-yanjing" ></span><span > <?php echo convert($_thread['views']);?></span></span>
									

									
									<a href="<?php echo url("thread-$_thread[tid]");?>#comments" class="ml-2"><span class="text-muted" data-toggle="tooltip" data-placement="top" title="评论"><span class="iconfont  icon-xiaoxi" ></span><span> <?php echo convert($_thread['posts']);?></span></span></a>
									
									<?php 
if (isset($haya_post_like_config['open_thread'])
	&& $haya_post_like_config['open_thread'] == 1
) {
?>
	<?php 
	if ((isset($haya_post_like_config['list_show_likes'])
		&& $haya_post_like_config['list_show_likes'] == 1)
		|| ($route == 'my' || $route == 'user')
	) {
	?>
		<span class="ml-2">
			<span class="iconfont icon-dianzan"></span>
			<span><?php echo intval($_thread['likes']);?></span>
		</span>
	<?php } ?>
	
<?php } ?><?php 
if ( 
	(isset($haya_favorite_config['thread_show_favorite']) && $haya_favorite_config['thread_show_favorite'] == 1)
	|| ($route == 'my' || $route == 'user')
) { 
?>
<span class="ml-2" title="<?php echo intval($_thread['favorites']);?> <?php echo lang('haya_favorite_name'); ?>">
	<i class="icon-star-o" aria-hidden="true"></i> 
	<?php echo intval($_thread['favorites']);?>
</span>
<?php } ?>
								</div>
								<div class="mt-1">
									
									<?php if (isset($light_config['thread_last_reply']) && $light_config['thread_last_reply'] == 1) { ?>  
									<?php if($_thread['lastuid']) { ?>
									<span>
										<a href="<?php echo url("user-$_thread[lastuid]");?>" tabindex="-1" >
											
											<?php 
											$lastImg = './upload/avatar/000/'.$_thread['lastuid'].'.png';
											$originImg = './view/img/avatar.png';
											if(file_exists($lastImg)) { ?>
											<img class="avatar-1" src="<?php echo $lastImg;?>">
											<?php }else{ ?>
											<img class="avatar-1" src="<?php echo $originImg;?>">
												<?php } ?>
										</a>
										<span class="username text-muted mr-lg-1" uid="<?php echo $_thread['lastuid'];?>"><?php echo $_thread['lastusername'];?>
											
										</span>
										<span class="text-grey"><span class="hidden-sm"><?php echo lang('last_reply');?></span><span class="mx-1">·</span><?php echo $_thread['last_date_fmt'];?></span>
									</span>
									<?php } ?>
									<?php }?>
									<?php if ($route == 'my' && $action == 'favorite') { ?>
<span class="ml-3">
	<a href="javascript:;" title="<?php echo lang('haya_favorite_remove_favorite'); ?>" class="text-grey text-small js-haya-favorite-remove" data-tid="<?php echo intval($_thread['tid']); ?>">
		<i class="icon-remove" aria-hidden="true"></i> 
		<?php echo lang('haya_favorite_remove_favorite'); ?>
	<a>
</span>
<?php } ?>

								</div>
								
							</div>
						</div>
						</div>
					</li>
					<?php }} else { ?>
					<div class="row justify-content-center">
						<div class="col-6">
							<div class="text-center my-5" style="color:gainsboro"><i
									class="fa fa-bug display-1"></i><br /><?php echo lang('none');?></div>
						</div>
					</div>
					<?php }?>
					

				 <?php } else if(isset($light_config['thread_list_style']) && $light_config['thread_list_style'] == 2){
					include _include(APP_PATH.'plugin/zaesky_theme_light/view/htm/thread_list.inc2.htm');
					}else if(isset($light_config['thread_list_style']) && $light_config['thread_list_style'] == 3){
					include _include(APP_PATH.'plugin/zaesky_theme_light/view/htm/thread_list.inc3.htm');
					}else if(isset($light_config['thread_list_style']) && $light_config['thread_list_style'] == 4){
					include _include(APP_PATH.'plugin/zaesky_theme_light/view/htm/thread_list.inc4.htm');
					}?>